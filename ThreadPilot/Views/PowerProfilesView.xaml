<UserControl x:Class="ThreadPilot.Views.PowerProfilesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ThreadPilot.Views"
             xmlns:converters="clr-namespace:ThreadPilot.Converters"
             Loaded="PowerProfilesView_Loaded"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <UserControl.Resources>
        <converters:BoolToInvisibilityConverter x:Key="BoolToInvisibilityConverter" />
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,10" />
        </Style>
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,15,0,10" />
        </Style>
        <Style x:Key="ProfileItemStyle" TargetType="ListViewItem">
            <Setter Property="Padding" Value="10" />
            <Setter Property="Margin" Value="0,2" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
            <Setter Property="Background" Value="{DynamicResource BackgroundBrushSecondary}" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <TextBlock Text="Power Profiles" Style="{StaticResource HeaderTextStyle}" Grid.Row="0" />
        
        <!-- Bundled Profiles Section -->
        <Grid Grid.Row="1" Margin="0,20,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <TextBlock Text="Bundled Power Profiles" Style="{StaticResource SectionHeaderStyle}" Grid.Row="0" />
            
            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10">
                <Button Command="{Binding RefreshProfilesCommand}" Margin="0,0,10,0" Padding="8,4" 
                        ToolTip="Refresh the list of power profiles">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M4.609,12.8a8,8,0,1,1,6.876,3.86V15.32a6.566,6.566,0,1,0-5.6-3.16H7.891l-2.2,2.209L4.5,16.5l-4-4,4-4,1.182,1.182L7.9,11.9Z" 
                              Fill="{DynamicResource ForegroundBrush}" Width="16" Height="16" Stretch="Uniform" />
                        <TextBlock Text="Refresh" Margin="5,0,0,0" />
                    </StackPanel>
                </Button>
                
                <Button Command="{Binding ImportProfileCommand}" Padding="8,4" 
                        ToolTip="Import a power profile from a .pow file">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M15.375,9.75v3.751l-1.524-1.524-.75.75L16,15.625l2.899-2.899-.75-.75-1.524,1.524V9.75ZM16,2C8.82,2,3,7.82,3,15s5.82,13,13,13,13-5.82,13-13S23.18,2,16,2Zm0,24C9.925,26,5,21.075,5,15S9.925,4,16,4s11,4.925,11,11-4.925,11-11,11Z" 
                              Fill="{DynamicResource ForegroundBrush}" Width="16" Height="16" Stretch="Uniform" />
                        <TextBlock Text="Import" Margin="5,0,0,0" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
        
        <!-- Profile List -->
        <Grid Grid.Row="2">
            <ListView ItemsSource="{Binding BundledProfiles}" 
                      SelectedItem="{Binding SelectedBundledProfile}"
                      BorderThickness="0"
                      Background="Transparent"
                      ItemContainerStyle="{StaticResource ProfileItemStyle}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <!-- Profile name -->
                            <TextBlock Text="{Binding Name}" 
                                       FontWeight="SemiBold" 
                                       FontSize="14" 
                                       Grid.Row="0" 
                                       Grid.Column="0" />
                            
                            <!-- Active indicator -->
                            <Border Grid.Row="0" 
                                    Grid.Column="1" 
                                    Margin="0,0,10,0"
                                    Padding="6,2" 
                                    Background="{DynamicResource AccentBrush}" 
                                    CornerRadius="4"
                                    Visibility="{Binding IsActive, Converter={StaticResource BoolToInvisibilityConverter}}">
                                <TextBlock Text="ACTIVE" 
                                           FontSize="10" 
                                           FontWeight="Bold" 
                                           Foreground="White" />
                            </Border>
                            
                            <!-- Imported indicator -->
                            <Border Grid.Row="0" 
                                    Grid.Column="2" 
                                    Padding="6,2" 
                                    Background="{DynamicResource BackgroundBrushTertiary}" 
                                    CornerRadius="4"
                                    Visibility="{Binding GuidInSystem, Converter={StaticResource BoolToInvisibilityConverter}}">
                                <TextBlock Text="IMPORTED" 
                                           FontSize="10" 
                                           FontWeight="Bold" 
                                           Foreground="{DynamicResource ForegroundBrushSecondary}" />
                            </Border>
                            
                            <!-- Description -->
                            <TextBlock Text="{Binding Description}" 
                                       Grid.Row="1" 
                                       Grid.Column="0" 
                                       Grid.ColumnSpan="3" 
                                       TextWrapping="Wrap" 
                                       Margin="0,5,0,0" 
                                       Foreground="{DynamicResource ForegroundBrushSecondary}" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            
            <!-- No profiles message -->
            <TextBlock Text="No power profiles found. Click 'Import' to add a power profile." 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center" 
                       Foreground="{DynamicResource ForegroundBrushSecondary}"
                       Visibility="{Binding BundledProfiles.Count, Converter={StaticResource BoolToInvisibilityConverter}, ConverterParameter=Inverse}" />
            
            <!-- Loading indicator -->
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Center" 
                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToInvisibilityConverter}}">
                <TextBlock Text="Loading profiles..." 
                           HorizontalAlignment="Center" 
                           Foreground="{DynamicResource ForegroundBrushSecondary}" />
                <ProgressBar IsIndeterminate="True" 
                             Width="200" 
                             Height="4" 
                             Margin="0,10,0,0" />
            </StackPanel>
        </Grid>
        
        <!-- Profile Actions -->
        <Border Grid.Row="2" 
                VerticalAlignment="Bottom" 
                HorizontalAlignment="Right" 
                Background="{DynamicResource BackgroundBrushSecondary}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="1"
                CornerRadius="4"
                Padding="10"
                Margin="0,0,0,10"
                Visibility="{Binding IsProfileSelected, Converter={StaticResource BoolToInvisibilityConverter}}">
            <StackPanel Orientation="Horizontal">
                <Button Command="{Binding ActivateProfileCommand}" 
                        Padding="8,4" 
                        Margin="0,0,10,0"
                        Visibility="{Binding IsProfileActive, Converter={StaticResource BoolToInvisibilityConverter}, ConverterParameter=Inverse}">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M8,5V19l11-7L8,5z" 
                              Fill="{DynamicResource AccentBrush}" 
                              Width="12" 
                              Height="12" 
                              Stretch="Uniform" />
                        <TextBlock Text="Activate Profile" 
                                   Margin="5,0,0,0" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>